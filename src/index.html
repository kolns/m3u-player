<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>m3u Player</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script src="hls.min.js"></script>
  <script src="mpegts.min.js"></script>
  <script type="module" src="/main.js" defer></script>
</head>

<body>
  <!-- Custom Titlebar -->
  <div id="titlebar" data-tauri-drag-region>
    <span id="titlebar-title" data-tauri-drag-region>m3u Player</span>
    <div id="titlebar-controls">
      <button id="titlebar-minimize" class="titlebar-btn" title="Minimize">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14" />
        </svg>
      </button>
      <button id="titlebar-maximize" class="titlebar-btn" title="Maximize">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="5" width="14" height="14" rx="1" />
        </svg>
      </button>
      <button id="titlebar-close" class="titlebar-btn titlebar-close" title="Close">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main id="app">
    <section id="player-section">
      <div id="player-wrapper">
        <video id="video-player" autoplay controls></video>
        <div id="player-overlay" class="visible">
          <svg viewBox="0 0 24 24" fill="currentColor" width="64" height="64">
            <path d="M8 5v14l11-7z" />
          </svg>
          <p>Open Channels to get started</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer Bar -->
  <footer id="footer">
    <div id="footer-left">
      <span id="now-playing-dot" class="hidden"></span>
      <span id="now-playing-name">No channel selected</span>
      <button id="stop-btn" class="hidden" title="Stop playback">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
          stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Easter egg credits -->
    <div id="credits-egg">
      <button id="credits-star" title="✦" aria-label="Credits">✦</button>
      <div id="credits-popover" class="hidden">
        <div class="credits-content">
          <div class="credits-header">Powered by</div>
          <div class="credits-links">
            <a href="https://getchannels.com/dvr-server/" target="_blank" rel="noopener" class="credits-link">
              <span class="credits-label">Channels DVR</span>
              <span class="credits-tagline">Your TV, your way</span>
            </a>
            <a href="https://github.com/hjdhjd/prismcast" target="_blank" rel="noopener" class="credits-link">
              <span class="credits-label">PrismCast</span>
              <span class="credits-tagline">Streaming, refracted</span>
            </a>
          </div>
          <div class="credits-footer">https://github.com/mike-d-smith/tv</div>
        </div>
      </div>
    </div>

    <button id="channels-btn" title="Show channels">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <rect x="2" y="3" width="20" height="18" rx="2" />
        <path d="M8 7h8M8 12h8M8 17h4" />
      </svg>
      <span>Channels</span>
    </button>
  </footer>

  <!-- Channel Drawer -->
  <div id="drawer-backdrop" class="hidden"></div>
  <aside id="channel-drawer">
    <div id="drawer-handle">
      <div id="drawer-handle-bar"></div>
    </div>

    <!-- Tab Navigation -->
    <div id="drawer-tabs">
      <button class="drawer-tab active" data-tab="channels">My Channels</button>
      <button class="drawer-tab" data-tab="sources">Sources</button>
    </div>

    <!-- Tab 1: My Channels -->
    <div id="tab-channels" class="tab-content">
      <div id="channel-grid"></div>
      <p id="no-channels" class="empty-state">
        Add channels from the <strong>Sources</strong> tab to get started
      </p>
    </div>

    <!-- Tab 2: Manage Sources -->
    <div id="tab-sources" class="tab-content hidden">
      <!-- Add Source Form -->
      <div id="add-source-form">
        <input type="text" id="source-name" placeholder="Source name (e.g. Channels DVR)" autocomplete="off" />
        <input type="url" id="source-url" placeholder="M3U playlist URL" autocomplete="off" spellcheck="false" />
        <button id="add-source-btn" type="button">Add Source</button>
      </div>
      <p id="source-error" class="error-msg hidden"></p>
      <div id="source-list"></div>
      <p id="no-sources" class="empty-state">
        No sources added yet. Add an M3U playlist URL above.
      </p>
    </div>

    <!-- Tab 3: Browse Source (shown when browsing a source's channels) -->
    <div id="tab-browse" class="tab-content hidden">
      <div id="browse-header">
        <button id="browse-back" title="Back to sources">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
        </button>
        <div id="browse-title">
          <h3 id="browse-source-name"></h3>
          <span id="browse-count"></span>
        </div>
        <button id="browse-add-all" class="text-btn">Add All</button>
      </div>
      <div id="browse-grid"></div>
      <div id="browse-loading" class="empty-state hidden">Loading channels...</div>
    </div>
  </aside>
</body>

</html>